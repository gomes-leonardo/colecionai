generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum ProductCondition {
  NEW
  USED
  OPEN_BOX
}

enum AuctionStatus {
  OPEN      
  CLOSED   
  CANCELLED 
}

enum ProductCategory {
  ACTION_FIGURES
  COLLECTIBLE_STATUES
  FUNKO_POP
  TRADING_CARDS
  COMIC_BOOKS
  MANGA
  RETRO_GAMES
  MINIATURES
  MODEL_KITS
  MOVIES_TV_COLLECTIBLES
  ANIME_COLLECTIBLES
  ART_BOOKS
  RARE_COLLECTIBLES
}

model Product {
  id          String           @id @default(uuid())
  name        String           @db.VarChar(255)
  price       Int
  description String           @db.Text
  category    ProductCategory
  condition   ProductCondition
  user_id     String
  banner      String?          @db.VarChar(255)
  created_at  DateTime         @default(now()) @db.Timestamp(6)
  updated_at  DateTime         @updatedAt
  auction     Auction?

  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("products")
}

model User {
  id          String      @id @default(uuid())
  name        String      @db.VarChar(255)
  email       String      @unique @db.VarChar(255)
  password    String      @db.VarChar(255)
  created_at  DateTime    @default(now()) @db.Timestamp(6)
  is_verified Boolean     @default(false)
  products    Product[]
  usertoken   UserToken[]
  
  bids        Bid[]

  @@map("users")
}

model UserToken {
  id            String   @id @default(uuid())
  reset_password_token String?
  verify_email_token  String?
  user_id       String
  created_at    DateTime @default(now()) @db.Timestamp(6)
  expires_at    DateTime
  user          User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("usertoken")
}

model Auction {
  id            String    @id @default(uuid())
  start_date    DateTime
  end_date      DateTime
  start_price   Decimal  @db.Decimal(10, 2)
  product_id    String   @unique
  product       Product @relation(fields: [product_id], references: [id], onDelete: Cascade)
  bids          Bid[]
  status        AuctionStatus @default(OPEN)

  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  @@map("auctions")
}

model Bid {
  id         String   @id @default(uuid())
  amount     Decimal  @db.Decimal(10, 2)
  created_at DateTime @default(now())

  user_id    String
  user       User     @relation(fields: [user_id], references: [id])

  auction_id String
  auction    Auction  @relation(fields: [auction_id], references: [id])

  @@map("bids")
}
